<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <title>{{ report.title }}</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">

    

    <style>

        /* --- 1. DESIGN TOKENS --- */

        :root {

            --primary: {{ client.primary_color | default('#10b981') }};

            --primary-dim: {{ client.primary_color | default('#10b981') }}15;

            --dark: #050505;

            --slate: #64748b;

            --border: #e2e8f0;

            

            /* Severity Colors */

            --sev-critical: #be123c; --sev-critical-bg: #fff1f2;

            --sev-high: #c2410c;     --sev-high-bg: #fff7ed;

            --sev-medium: #eab308;   --sev-medium-bg: #fefce8;

            --sev-low: #10b981;      --sev-low-bg: #ecfdf5;

            --sev-info: #3b82f6;     --sev-info-bg: #eff6ff;

        }



        /* --- 2. PAGE GEOMETRY --- */

        @page {

            size: A4;

            margin-top: 30mm;

            margin-bottom: 20mm;

            margin-left: 20mm;

            margin-right: 20mm;

        }



        @page :first { margin: 0 !important; } /* Full Bleed Cover */



        body {

            font-family: 'Inter', sans-serif;

            font-size: 10pt;

            line-height: 1.5;

            color: #1e293b;

            margin: 0;

            background: #fff;

            -webkit-print-color-adjust: exact;

        }



        .page-break { page-break-after: always; }

        .no-break { page-break-inside: avoid; }



        /* --- 3. COVER PAGE (Keep exactly as approved) --- */

        .cover-page {

            width: 210mm; height: 297mm;

            background-color: var(--dark); color: white;

            position: relative; z-index: 9999;

            display: flex; flex-direction: column; justify-content: center;

            background-image: 

                linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),

                linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);

            background-size: 40px 40px;

        }

        .cover-bar { position: absolute; left: 0; top: 0; bottom: 0; width: 6px; background: var(--primary); box-shadow: 0 0 20px var(--primary-dim); }

        .cover-content { padding: 0 25mm; }

        .confidential-pill {

            font-family: 'JetBrains Mono', monospace; font-size: 9pt; color: var(--primary);

            border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.02);

            padding: 6px 12px; border-radius: 100px; display: inline-block; margin-bottom: 30px;

            text-transform: uppercase; letter-spacing: 1px;

        }

        h1.cover-title { font-size: 42pt; font-weight: 700; line-height: 1.1; color: #ffffff; margin: 0; letter-spacing: -0.03em; }

        .cover-footer {

            position: absolute; bottom: 0; left: 0; right: 0; padding: 20mm 25mm;

            border-top: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.2);

            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;

        }

        .cf-label { font-family: 'JetBrains Mono'; font-size: 7pt; color: #52525b; text-transform: uppercase; display: block; margin-bottom: 5px; }

        .cf-value { font-size: 10pt; font-weight: 600; color: #fff; }



        /* --- 4. INTERNAL LAYOUT --- */

        .running-header {

            position: fixed; top: -20mm; left: 0; right: 0; height: 10mm;

            display: flex; justify-content: space-between; align-items: center;

            border-bottom: 2px solid var(--primary); background: #fff; padding-bottom: 5px; z-index: 100;

        }

        .rh-logo { font-weight: 800; color: var(--dark); font-size: 11pt; }

        .rh-meta { font-family: 'JetBrains Mono'; font-size: 8pt; color: var(--slate); text-transform: uppercase; }



        h2.section-title {

            font-size: 16pt; text-transform: uppercase; letter-spacing: 0.05em; color: var(--dark); 

            border-bottom: 2px solid var(--dark); padding-bottom: 10px; margin-bottom: 30px; margin-top: 0;

        }



        /* --- 5. PROJECT DASHBOARD (Testing Info Chart) --- */

        .project-meta-grid {

            display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 40px;

        }

        .meta-card {

            border: 1px solid var(--border); border-radius: 6px; padding: 15px;

            background: #f8fafc;

        }

        .meta-card-label {

            font-size: 8pt; text-transform: uppercase; color: var(--slate); font-weight: 700; margin-bottom: 5px;

        }

        .meta-card-value {

            font-size: 11pt; font-weight: 600; color: var(--dark);

        }



        /* Scope Box */

        .scope-box {

            border: 1px solid var(--border); border-radius: 6px; padding: 20px; margin-bottom: 30px;

        }

        .scope-item {

            font-family: 'JetBrains Mono'; font-size: 9pt; padding: 8px; border-bottom: 1px solid #f1f5f9; display: flex; align-items: center;

        }

        .scope-item:last-child { border-bottom: none; }

        .scope-icon { color: var(--primary); margin-right: 10px; }



        /* --- 6. SUMMARY CHARTS (CSS Bars) --- */

        .risk-dashboard {

            display: flex; gap: 30px; align-items: stretch; margin-bottom: 40px;

        }

        .risk-donut-container {

            width: 150px; text-align: center; display: flex; flex-direction: column; justify-content: center;

        }

        .risk-circle {

            width: 100px; height: 100px; border-radius: 50%; border: 8px solid var(--dark);

            margin: 0 auto 10px auto; display: flex; flex-direction: column; justify-content: center;

        }

        .risk-grid {

            flex-grow: 1; display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px;

        }

        .risk-stat-box {

            border: 1px solid var(--border); border-radius: 6px; padding: 15px; text-align: center;

        }

        .rs-num { font-size: 20pt; font-weight: 800; display: block; }

        .rs-lbl { font-size: 7pt; font-weight: 700; text-transform: uppercase; color: var(--slate); }



        /* --- 7. DETAILED FINDING GRID (The New Requirement) --- */

        .finding-card {

            border: 1px solid var(--border); margin-bottom: 30px;

            page-break-inside: avoid; background: #fff; border-radius: 6px; overflow: hidden;

            box-shadow: 0 4px 10px rgba(0,0,0,0.03);

        }



        /* A. The Colored Strip */

        .finding-header-strip {

            padding: 8px 20px; color: white; font-weight: 700; font-size: 10pt;

            display: flex; justify-content: space-between; align-items: center;

        }

        /* Severity Colors */

        .bg-CRITICAL { background: var(--sev-critical); }

        .bg-HIGH { background: var(--sev-high); }

        .bg-MEDIUM { background: var(--sev-medium); }

        .bg-LOW { background: var(--sev-low); }

        .bg-INFO { background: var(--sev-info); }



        /* B. The Metadata Grid (Boxy & Gray) */

        .finding-meta-grid {

            display: grid; grid-template-columns: 2fr 1fr; 

            border-bottom: 1px solid var(--border);

            background: #f8fafc;

        }

        

        .meta-cell {

            padding: 12px 20px;

            border-right: 1px solid var(--border);

            border-bottom: 1px solid var(--border);

        }

        .meta-cell:last-child { border-right: none; }

        .meta-cell-full { grid-column: span 2; border-right: none; }



        .f-label {

            display: block; font-family: 'JetBrains Mono'; font-size: 7pt; font-weight: 700; 

            text-transform: uppercase; color: var(--slate); margin-bottom: 4px;

        }

        .f-value { font-size: 10pt; font-weight: 600; color: var(--dark); }

        .f-value-mono { font-family: 'JetBrains Mono'; font-size: 9pt; }



        /* C. The Content Body */

        .finding-content { padding: 25px 30px; }

        

        .content-section { margin-bottom: 25px; }

        .content-title {

            font-size: 9pt; font-weight: 700; text-transform: uppercase; 

            color: var(--dark); border-bottom: 2px solid var(--primary); 

            display: inline-block; margin-bottom: 10px; padding-bottom: 2px;

        }



        /* Evidence Images */

        .evidence-container { margin-top: 15px; border: 1px solid var(--border); padding: 5px; background: #fafafa; }

        .evidence-container img { width: 100%; display: block; }

        .evidence-caption { text-align: center; font-size: 8pt; color: var(--slate); padding: 5px; font-family: 'JetBrains Mono'; }



        /* Footer */

        .page-footer {

            position: fixed; bottom: -15mm; left: 0; right: 0;

            display: flex; justify-content: space-between; align-items: center;

            font-size: 7pt; color: var(--slate); text-transform: uppercase; letter-spacing: 0.05em;

        }

        

        /* Markdown */

        .markdown-body { font-size: 10pt; color: #334155; }

        .markdown-body pre { background: #f1f5f9; padding: 10px; border: 1px solid var(--border); border-radius: 4px; white-space: pre-wrap; font-family: 'JetBrains Mono'; font-size: 8pt; }

    </style>

</head>

<body>



    <div class="running-header">

        <div class="rh-logo">

            {% if client.logo %}<img src="{{ client.logo }}" style="height: 25px; margin-right: 10px;">{% endif %}

            <span>{{ client.name }}</span>

        </div>

        <div class="rh-meta">{{ report.title }}</div>

    </div>



    <div class="cover-page page-break">

        <div class="cover-bar"></div>

        <div class="cover-content">

            <span class="confidential-pill">CONFIDENTIAL</span>

            <h1 class="cover-title">{{ report.title }}</h1>

        </div>

        <div class="cover-footer">

            <div>

                <span class="cf-label">PREPARED FOR</span>

                <span class="cf-value">{{ client.name }}</span>

            </div>

            <div style="text-align: center;">

                <span class="cf-label">DATE</span>

                <span class="cf-value">{{ report.date }}</span>

            </div>

            <div style="text-align: right;">

                <span class="cf-label">REFERENCE ID</span>

                <span class="cf-value" style="font-family: 'JetBrains Mono'">{{ report.id[:8] }}</span>

            </div>

        </div>

    </div>



    <div class="page-break">

        <h2 class="section-title">Project Information</h2>

        

        <div class="project-meta-grid">

            <div class="meta-card">

                <div class="meta-card-label">Report Name</div>

                <div class="meta-card-value">{{ report.title }}</div>

            </div>

            <div class="meta-card">

                <div class="meta-card-label">Lead Assigned</div>

                <div class="meta-card-value">{{ project.lead_tester or 'Security Team' }}</div>

            </div>

            <div class="meta-card">

                <div class="meta-card-label">Testing Dates</div>

                <div class="meta-card-value">{{ project.start_date }} - {{ project.end_date }}</div>

            </div>

            <div class="meta-card">

                <div class="meta-card-label">Delivery Date</div>

                <div class="meta-card-value">{{ report.date }}</div>

            </div>

        </div>



        <h2 class="section-title">Assessment Scope</h2>

        <div class="scope-box">

            {% if project.scope %}

                {% for item in project.scope %}

                <div class="scope-item">

                    <span class="scope-icon">Target:</span> {{ item }}

                </div>

                {% endfor %}

            {% else %}

                <div class="scope-item">No specific scope items defined.</div>

            {% endif %}

        </div>

    </div>



    <div class="page-break">

        <h2 class="section-title">Summary of Findings</h2>

        

        <div class="risk-dashboard">

            <div class="risk-donut-container">

                <div class="risk-circle">

                    <span style="font-size: 24pt; font-weight: 800;">{{ findings|length }}</span>

                </div>

                <span style="font-size: 8pt; font-weight: 700; text-transform: uppercase; color: var(--slate);">Total Issues</span>

            </div>

            

            <div class="risk-grid">

                <div class="risk-stat-box">

                    <span class="rs-num" style="color: var(--sev-critical)">{{ stats.critical }}</span>

                    <span class="rs-lbl">Critical</span>

                </div>

                <div class="risk-stat-box">

                    <span class="rs-num" style="color: var(--sev-high)">{{ stats.high }}</span>

                    <span class="rs-lbl">High</span>

                </div>

                <div class="risk-stat-box">

                    <span class="rs-num" style="color: var(--sev-medium)">{{ stats.medium }}</span>

                    <span class="rs-lbl">Medium</span>

                </div>

                <div class="risk-stat-box">

                    <span class="rs-num" style="color: var(--sev-low)">{{ stats.low }}</span>

                    <span class="rs-lbl">Low</span>

                </div>

            </div>

        </div>



        <h2 class="section-title">Executive Narrative</h2>

        <div class="markdown-body">

            {{ report.executive_summary | safe }}

        </div>

    </div>



    <div>

        <h2 class="section-title">Detailed Findings</h2>



        {% for finding in findings %}

        <div class="finding-card">

            <div class="finding-header-strip bg-{{ finding.severity | upper }}">

                <span>FINDING RECORD</span>

                <span style="font-family: 'JetBrains Mono'">{{ finding.finding_id }}</span>

            </div>



            <div class="finding-meta-grid">

                <div class="meta-cell">

                    <span class="f-label">Finding Name</span>

                    <div class="f-value">{{ finding.title }}</div>

                </div>

                <div class="meta-cell">

                    <span class="f-label">Severity</span>

                    <div class="f-value" style="color: var(--sev-{{ finding.severity | lower }})">{{ finding.severity }}</div>

                </div>

                

                <div class="meta-cell">

                    <span class="f-label">Affected Assets</span>

                    <div class="f-value-mono">

                        {% if finding.assets %}

                            {{ finding.assets | join(', ') }}

                        {% else %}

                            All Systems

                        {% endif %}

                    </div>

                </div>

                <div class="meta-cell">

                    <span class="f-label">Remediation Policy</span>

                    <div class="f-value-mono">

                        {% if finding.severity == 'CRITICAL' %}Immediate / 24h

                        {% elif finding.severity == 'HIGH' %}7 Days

                        {% elif finding.severity == 'MEDIUM' %}30 Days

                        {% else %}90 Days{% endif %}

                    </div>

                </div>

            </div>



            <div class="finding-content">

                <div class="content-section">

                    <div class="content-title">Description</div>

                    <div class="markdown-body">{{ finding.description_html | safe }}</div>

                </div>



                <div class="content-section">

                    <div class="content-title">Remediation</div>

                    <div class="markdown-body">{{ finding.remediation_html | safe }}</div>

                </div>



                {% if finding.references %}

                <div class="content-section">

                    <div class="content-title">References</div>

                    <ul class="markdown-body" style="padding-left: 20px;">

                        {% for ref in finding.references %}

                        <li><a href="{{ ref }}" style="color: var(--primary);">{{ ref }}</a></li>

                        {% endfor %}

                    </ul>

                </div>

                {% endif %}



                {% if finding.evidence_items %}

                <div class="content-section no-break">

                    <div class="content-title">Proof of Concept / Evidence</div>

                    {% for item in finding.evidence_items %}

                    <div class="evidence-container">

                        {% if item.url %}<img src="{{ item.url }}">{% endif %}

                        <div class="evidence-caption">{{ item.caption }}</div>

                    </div>

                    {% endfor %}

                </div>

                {% endif %}

            </div>

        </div>

        {% endfor %}

    </div>



    <div class="page-footer">

        <div>{{ client.name }}</div>

        <div>Confidential // Do Not Distribute</div>

        <div>Atomik Security</div>

    </div>



</body>

</html>
